(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380],{3873:(e,t,a)=>{"use strict";a.d(t,{W:()=>o,i:()=>c});var s=a(5155),r=a(2115),d=a(283),n=a(5317),i=a(7039);let l=(0,r.createContext)(void 0),o=e=>{let{children:t}=e,{user:a,loading:o}=(0,d.A)(),[c,u]=(0,r.useState)(null),[m,p]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e;if(o)return void p(!0);if((null==a?void 0:a.activeWeddingId)&&i.db){p(!0);let t=(0,n.H9)(i.db,"weddings",a.activeWeddingId);e=(0,n.aQ)(t,e=>{e.exists()?u({id:e.id,...e.data()}):(u(null),console.warn("Firestore_WeddingContext: Active wedding session ".concat(a.activeWeddingId," not found."))),p(!1)},e=>{console.error("Firestore_WeddingContext: Error listening to wedding session:",e),u(null),p(!1)})}else u(null),p(!1);return()=>{e&&e()}},[a,o]),(0,s.jsx)(l.Provider,{value:{weddingSession:c,setWeddingSession:u,loadingSession:m},children:t})},c=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useWedding must be used within a WeddingProvider");return e}},4636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>i,Wv:()=>l,hl:()=>o});var s=a(5155),r=a(2115),d=a(547),n=a(9434);let i=d.bL,l=d.l9,o=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...l}=e;return(0,s.jsx)(d.ZL,{children:(0,s.jsx)(d.UC,{ref:t,align:r,sideOffset:i,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});o.displayName=d.UC.displayName},4820:(e,t,a)=>{Promise.resolve().then(a.bind(a,6944))},5511:(e,t,a)=>{"use strict";a.d(t,{V:()=>o});var s=a(5155);a(2115);var r=a(965),d=a(3158),n=a(8049),i=a(9434),l=a(285);function o(e){let{className:t,classNames:a,showOutsideDays:o=!0,...c}=e;return(0,s.jsx)(n.hv,{showOutsideDays:o,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(d.A,{className:(0,i.cn)("h-4 w-4",t),...a})}},...c})}o.displayName="Calendar"},6126:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var s=a(5155);a(2115);var r=a(2085),d=a(9434);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,d.cn)(n({variant:a}),t),...r})}},6631:(e,t,a)=>{"use strict";a.d(t,{CI:()=>c,G6:()=>o,Ru:()=>l,VM:()=>m,bk:()=>i,eg:()=>u});var s=a(3004),r=a(7039),d=a(5317);let n=new s.HF,i=async(e,t,a)=>{let n=(await (0,s.eJ)(r.j2,e,t)).user;await (0,s.r7)(n,{displayName:a});let i={uid:n.uid,email:n.email,displayName:a,photoURL:n.photoURL,activeWeddingId:null};return await (0,d.BN)((0,d.H9)(r.db,"users",n.uid),i),i},l=async(e,t)=>{let a=await (0,s.x9)(r.j2,e,t);return(await (0,d.x7)((0,d.H9)(r.db,"users",a.user.uid))).data()},o=async()=>{let e=(await (0,s.df)(r.j2,n)).user,t=(0,d.H9)(r.db,"users",e.uid),a=await (0,d.x7)(t);if(!a.exists()){let a={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,activeWeddingId:null};return await (0,d.BN)(t,a),a}return a.data()},c=async()=>{await (0,s.CI)(r.j2)},u=async(e,t)=>{let a=(0,d.H9)(r.db,"users",e);return await (0,d.mZ)(a,t),(await (0,d.x7)(a)).data()},m=async e=>{let t=(0,d.H9)(r.db,"users",e),a=await (0,d.x7)(t);return a.exists()?a.data():null}},6944:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ei});var s=a(5155),r=a(2115),d=a(283),n=a(3873),i=a(8666),l=a(6631),o=a(285),c=a(172),u=a(9572),m=a(4301),p=a(960),x=a(6695),f=a(6126),h=a(6981),g=a(518),v=a(9434);let j=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(h.bL,{ref:t,className:(0,v.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,s.jsx)(h.C1,{className:(0,v.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(g.A,{className:"h-4 w-4"})})})});j.displayName=h.bL.displayName;var y=a(4386),b=a(5948),w=a(3013),N=a(286),k=a(1721),C=a(3129),A=a(7223),D=a(7481);function I(e){let{task:t,onEdit:a,onDelete:r,currentUserId:d,partners:n}=e,{toast:l}=(0,D.dj)(),c=(0,y.c)(t.deadline.toDate(),new Date),u=(0,b.R)(t.deadline.toDate())&&"completed"!==t.status,m=u?"overdue":t.status,p=async e=>{try{await (0,i.lC)(t.id,{status:e?"completed":"pending"}),l({title:"Task Updated",description:'Task "'.concat(t.title,'" marked as ').concat(e?"completed":"pending",".")})}catch(e){l({variant:"destructive",title:"Error",description:"Failed to update task: ".concat(e.message)})}};return(0,s.jsxs)(x.Zp,{className:(0,v.cn)("overflow-hidden transition-all duration-300 ease-in-out hover:shadow-xl","completed"===m?"bg-primary/5 border-primary/20":"overdue"===m?"bg-destructive/5 border-destructive/20":"bg-card"),children:[(0,s.jsxs)(x.aR,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsx)(x.ZB,{className:(0,v.cn)("text-lg leading-tight","completed"===m&&"line-through text-muted-foreground"),children:t.title}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsx)(j,{checked:"completed"===m,onCheckedChange:e=>p(!!e),"aria-label":"Mark task ".concat(t.title," as ").concat("completed"===m?"pending":"completed"),className:(0,v.cn)("completed"===m?"border-primary data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground":"")})})]}),t.description&&(0,s.jsx)(x.BT,{className:(0,v.cn)("text-xs pt-1","completed"===m&&"line-through text-muted-foreground/80"),children:t.description})]}),(0,s.jsxs)(x.Wu,{className:"pb-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[t.assignedTo.length>1?(0,s.jsx)(N.A,{className:"h-3 w-3"}):(0,s.jsx)(k.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:t.assignedTo.length===n.length&&n.length>1?"Both":t.assignedTo.map(e=>{var t;if(e===d)return"You";let a=n.find(t=>t.uid===e);return(null==a||null==(t=a.displayName)?void 0:t.split(" ")[0])||"Partner"}).join(", ")})]}),(0,s.jsx)(f.E,{variant:(()=>{switch(m){case"completed":return"default";case"overdue":return"destructive";case"pending":return"secondary";default:return"outline"}})(),className:"capitalize text-xs px-2 py-0.5",children:(()=>{switch(m){case"completed":return"Completed";case"overdue":return"Overdue";default:return"Pending"}})()})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsxs)("span",{className:(0,v.cn)("font-medium",u?"text-destructive":c<3?"text-amber-600":"text-foreground/80"),children:["Due: ",(0,w.GP)(t.deadline.toDate(),"dd MMM, yyyy")]}),(0,s.jsx)("span",{className:(0,v.cn)("font-semibold",u||c<0?"text-destructive":c<3?"text-amber-600":"text-green-600"),children:"completed"===m?"Completed!":c<0?"".concat(Math.abs(c)," day(s) overdue"):"".concat(c," day(s) left")})]})]}),(0,s.jsxs)(x.wL,{className:"bg-muted/30 py-2 px-4 flex justify-end space-x-2",children:[(0,s.jsx)(o.$,{variant:"ghost",size:"icon",onClick:()=>a(t),"aria-label":"Edit task",children:(0,s.jsx)(C.A,{className:"h-4 w-4"})}),(0,s.jsx)(o.$,{variant:"ghost",size:"icon",onClick:()=>r(t.id),"aria-label":"Delete task",children:(0,s.jsx)(A.A,{className:"h-4 w-4 text-destructive/80 hover:text-destructive"})})]})]})}var T=a(221),_=a(2177),E=a(5594),R=a(7759),M=a(2523);let P=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,v.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});P.displayName="Textarea";var U=a(4636),W=a(5511),H=a(4582),z=a(9556),S=a(7381);let L=H.bL;H.YJ;let J=H.WT,V=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(H.l9,{ref:t,className:(0,v.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...d,children:[r,(0,s.jsx)(H.In,{asChild:!0,children:(0,s.jsx)(z.A,{className:"h-4 w-4 opacity-50"})})]})});V.displayName=H.l9.displayName;let F=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.PP,{ref:t,className:(0,v.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(S.A,{className:"h-4 w-4"})})});F.displayName=H.PP.displayName;let O=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.wn,{ref:t,className:(0,v.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(z.A,{className:"h-4 w-4"})})});O.displayName=H.wn.displayName;let Z=r.forwardRef((e,t)=>{let{className:a,children:r,position:d="popper",...n}=e;return(0,s.jsx)(H.ZL,{children:(0,s.jsxs)(H.UC,{ref:t,className:(0,v.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===d&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:d,...n,children:[(0,s.jsx)(F,{}),(0,s.jsx)(H.LM,{className:(0,v.cn)("p-1","popper"===d&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(O,{})]})})});Z.displayName=H.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.JU,{ref:t,className:(0,v.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=H.JU.displayName;let B=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(H.q7,{ref:t,className:(0,v.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...d,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(H.VF,{children:(0,s.jsx)(g.A,{className:"h-4 w-4"})})}),(0,s.jsx)(H.p4,{children:r})]})});B.displayName=H.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(H.wv,{ref:t,className:(0,v.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=H.wv.displayName;var Y=a(1920),q=a(5317);let $=E.Ik({title:E.Yj().min(3,{message:"Title must be at least 3 characters."}),description:E.Yj().optional(),deadline:E.p6({required_error:"Deadline is required."}),assignedTo:E.YO(E.Yj()).min(1,{message:"Assign task to at least one person."}),status:E.k5(["pending","completed","overdue"]).default("pending")});function G(e){let{task:t,onFormSubmit:a,partners:l}=e,{user:u}=(0,d.A)(),{weddingSession:m}=(0,n.i)(),{toast:p}=(0,D.dj)(),[x,f]=(0,r.useState)(!1),h=(0,_.mN)({resolver:(0,T.u)($),defaultValues:t?{title:t.title,description:t.description||"",deadline:t.deadline.toDate(),assignedTo:t.assignedTo,status:t.status}:{title:"",description:"",deadline:new Date,assignedTo:u?[u.uid]:[],status:"pending"}});async function g(e){if(!u||!m)return void p({variant:"destructive",title:"Error",description:"User or wedding session not found."});f(!0);let s={...e,deadline:q.Dc.fromDate(e.deadline),weddingId:m.id,createdBy:u.uid};try{t?(await (0,i.lC)(t.id,s),p({title:"Task Updated!",description:'"'.concat(e.title,'" has been updated.')})):(await (0,i.UT)(s),p({title:"Task Created!",description:'"'.concat(e.title,'" has been added.')})),a(),h.reset(t?{}:{title:"",description:"",deadline:new Date(new Date().setDate(new Date().getDate()+7)),assignedTo:u?[u.uid]:[],status:"pending"})}catch(e){p({variant:"destructive",title:"Error",description:e.message})}finally{f(!1)}}(0,r.useEffect)(()=>{t?h.reset({title:t.title,description:t.description||"",deadline:t.deadline.toDate(),assignedTo:t.assignedTo,status:t.status}):u&&h.reset({title:"",description:"",deadline:new Date(new Date().setDate(new Date().getDate()+7)),assignedTo:[u.uid],status:"pending"})},[t,h,u]);let j=(0,r.useMemo)(()=>{let e=[{value:(null==u?void 0:u.uid)||"me",label:"Me"}],t=(null==m?void 0:m.partnerIds)||[];return l.forEach(a=>{a.uid!==(null==u?void 0:u.uid)&&t.includes(a.uid)&&e.push({value:a.uid,label:a.displayName||"Partner"})}),2===t.length&&2===e.length&&e.push({value:"both",label:"Both"}),e},[u,l,null==m?void 0:m.partnerIds]);return(0,s.jsx)(R.lV,{...h,children:(0,s.jsxs)("form",{onSubmit:h.handleSubmit(g),className:"space-y-6",children:[(0,s.jsx)(R.zB,{control:h.control,name:"title",render:e=>{let{field:t}=e;return(0,s.jsxs)(R.eI,{children:[(0,s.jsx)(R.lR,{children:"Task Title"}),(0,s.jsx)(R.MJ,{children:(0,s.jsx)(M.p,{placeholder:"e.g., Book photographer",...t})}),(0,s.jsx)(R.C5,{})]})}}),(0,s.jsx)(R.zB,{control:h.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(R.eI,{children:[(0,s.jsx)(R.lR,{children:"Description (Optional)"}),(0,s.jsx)(R.MJ,{children:(0,s.jsx)(P,{placeholder:"Add more details about the task...",...t})}),(0,s.jsx)(R.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)(R.zB,{control:h.control,name:"deadline",render:e=>{let{field:t}=e;return(0,s.jsxs)(R.eI,{className:"flex flex-col",children:[(0,s.jsx)(R.lR,{children:"Deadline"}),(0,s.jsxs)(U.AM,{children:[(0,s.jsx)(U.Wv,{asChild:!0,children:(0,s.jsx)(R.MJ,{children:(0,s.jsxs)(o.$,{variant:"outline",className:(0,v.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,w.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"}),(0,s.jsx)(Y.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(U.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(W.V,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),(0,s.jsx)(R.C5,{})]})}}),(0,s.jsx)(R.zB,{control:h.control,name:"assignedTo",render:e=>{var t,a;let{field:r}=e;return(0,s.jsxs)(R.eI,{children:[(0,s.jsx)(R.lR,{children:"Assign To"}),(0,s.jsxs)(L,{onValueChange:e=>{"both"===e&&u&&(null==m?void 0:m.partnerIds)?r.onChange(m.partnerIds):r.onChange([e])},defaultValue:r.value.length===((null==m||null==(t=m.partnerIds)?void 0:t.length)||0)&&((null==m||null==(a=m.partnerIds)?void 0:a.length)||0)>1?"both":r.value[0],children:[(0,s.jsx)(R.MJ,{children:(0,s.jsx)(V,{children:(0,s.jsx)(J,{placeholder:"Select assignee"})})}),(0,s.jsx)(Z,{children:j.map(e=>(0,s.jsx)(B,{value:e.value,children:e.label},e.value))})]}),(0,s.jsx)(R.C5,{})]})}})]}),t&&(0,s.jsx)(R.zB,{control:h.control,name:"status",render:e=>{let{field:t}=e;return(0,s.jsxs)(R.eI,{children:[(0,s.jsx)(R.lR,{children:"Status"}),(0,s.jsxs)(L,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(R.MJ,{children:(0,s.jsx)(V,{children:(0,s.jsx)(J,{placeholder:"Select status"})})}),(0,s.jsxs)(Z,{children:[(0,s.jsx)(B,{value:"pending",children:"Pending"}),(0,s.jsx)(B,{value:"completed",children:"Completed"}),(0,s.jsx)(B,{value:"overdue",children:"Overdue"})]})]}),(0,s.jsx)(R.C5,{})]})}}),(0,s.jsxs)(o.$,{type:"submit",className:"w-full",disabled:x,children:[x&&(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Update Task":"Add Task"]})]})})}var Q=a(5452),K=a(5318);let X=Q.bL,ee=Q.l9,et=Q.ZL;Q.bm;let ea=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.hJ,{ref:t,className:(0,v.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});ea.displayName=Q.hJ.displayName;let es=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(et,{children:[(0,s.jsx)(ea,{}),(0,s.jsxs)(Q.UC,{ref:t,className:(0,v.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[r,(0,s.jsxs)(Q.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(K.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});es.displayName=Q.UC.displayName;let er=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,v.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};er.displayName="DialogHeader";let ed=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.hE,{ref:t,className:(0,v.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});ed.displayName=Q.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Q.VY,{ref:t,className:(0,v.cn)("text-sm text-muted-foreground",a),...r})}).displayName=Q.VY.displayName;var en=a(7039);function ei(){let{user:e}=(0,d.A)(),{weddingSession:t,loadingSession:a}=(0,n.i)(),[x,f]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),[v,j]=(0,r.useState)(!1),[y,b]=(0,r.useState)(void 0),[w,N]=(0,r.useState)([]),[k,C]=(0,r.useState)("all"),{toast:A}=(0,D.dj)();(0,r.useEffect)(()=>{if(!t||!e)return;g(!0);let a=(0,q.P)((0,q.rJ)(en.db,"tasks"),(0,q._M)("weddingId","==",t.id),(0,q.My)("deadline","asc")),s=(0,q.aQ)(a,e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),g(!1)},e=>{console.error("Error fetching tasks:",e),A({variant:"destructive",title:"Error",description:"Could not load tasks."}),g(!1)});return()=>s()},[t,e,A]),(0,r.useEffect)(()=>{if(!t||!t.partnerIds||0===t.partnerIds.length)return void N([]);(async()=>{try{let e=await Promise.all(t.partnerIds.map(e=>(0,l.VM)(e)));N(e.filter(e=>null!==e))}catch(e){console.error("Error fetching partner profiles:",e),A({variant:"destructive",title:"Error",description:"Could not load partner details."}),N([])}})()},[null==t?void 0:t.partnerIds,A]);let T=async e=>{if(confirm("Are you sure you want to delete this task?"))try{await (0,i.vq)(e),A({title:"Task Deleted",description:"The task has been successfully deleted."})}catch(e){A({variant:"destructive",title:"Error",description:"Failed to delete task: ".concat(e.message)})}},_=e=>{b(e),j(!0)},E=()=>{b(void 0),j(!0)},R=(0,r.useMemo)(()=>x.filter(t=>{let a="completed"!==t.status&&t.deadline.toDate()<new Date&&!M(t.deadline.toDate(),new Date);switch(k){case"my_tasks":return t.assignedTo.includes((null==e?void 0:e.uid)||"");case"completed":return"completed"===t.status;case"pending":return"pending"===t.status&&!a;case"overdue":return a;default:return!0}}),[x,k,e]),M=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();return a||h&&0===x.length&&!t?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,s.jsx)(c.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,s.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading tasks..."})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-headline text-primary",children:"Wedding Checklist"}),(0,s.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,s.jsxs)(L,{value:k,onValueChange:e=>C(e),children:[(0,s.jsxs)(V,{className:"w-full sm:w-[180px]",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),(0,s.jsx)(J,{placeholder:"Filter tasks"})]}),(0,s.jsxs)(Z,{children:[(0,s.jsx)(B,{value:"all",children:"All Tasks"}),(0,s.jsx)(B,{value:"my_tasks",children:"My Tasks"}),(0,s.jsx)(B,{value:"pending",children:"Pending"}),(0,s.jsx)(B,{value:"completed",children:"Completed"}),(0,s.jsx)(B,{value:"overdue",children:"Overdue"})]})]}),(0,s.jsxs)(X,{open:v,onOpenChange:j,children:[(0,s.jsx)(ee,{asChild:!0,children:(0,s.jsxs)(o.$,{onClick:E,className:"w-full sm:w-auto",children:[(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5"})," Add Task"]})}),(0,s.jsxs)(es,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(er,{children:(0,s.jsx)(ed,{className:"font-headline text-2xl text-primary",children:y?"Edit Task":"Add New Task"})}),(0,s.jsx)(G,{task:y,onFormSubmit:()=>j(!1),partners:w})]})]})]})]}),h&&0===x.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 border-2 border-dashed border-muted rounded-lg",children:[(0,s.jsx)(c.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Fetching your tasks..."})]}):0===R.length?(0,s.jsxs)("div",{className:"text-center py-10 border-2 border-dashed border-muted rounded-lg",children:[(0,s.jsx)(p.A,{className:"mx-auto h-16 w-16 text-muted-foreground"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"all"===k?"No tasks yet. Let's add some!":'No tasks match the filter "'.concat(k.replace("_"," "),'".')}),"all"===k&&(0,s.jsxs)(o.$,{onClick:E,className:"mt-4",children:[(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5"})," Add Your First Task"]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map(t=>(0,s.jsx)(I,{task:t,onEdit:_,onDelete:T,currentUserId:null==e?void 0:e.uid,partners:w},t.id))})]})}},8666:(e,t,a)=>{"use strict";a.d(t,{EA:()=>u,Pv:()=>i,UT:()=>m,dH:()=>l,ii:()=>o,lC:()=>p,r$:()=>n,vq:()=>x,yk:()=>c});var s=a(5317),r=a(7039);let d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a="";for(let s=0;s<e;s++)a+=t.charAt(Math.floor(Math.random()*t.length));return a},n=async(e,t)=>{let a=s.Dc.fromDate(t),n=d(),i=await (0,s.gS)((0,s.rJ)(r.db,"weddings"),{ownerId:e,partnerIds:[e],weddingDate:a,shareCode:n,createdAt:(0,s.O5)()});return await (0,s.mZ)((0,s.H9)(r.db,"users",e),{activeWeddingId:i.id}),{id:i.id,ownerId:e,partnerIds:[e],weddingDate:a,shareCode:n,createdAt:s.Dc.now()}},i=async(e,t)=>{let a=(0,s.H9)(r.db,"weddings",e),d=await (0,s.x7)(a);if(!d.exists())throw Error("Wedding session not found.");let n=d.data();if(n.partnerIds.includes(t))return await (0,s.mZ)((0,s.H9)(r.db,"users",t),{activeWeddingId:e}),{id:d.id,...n};if(n.partnerIds.length>=2)throw Error("Wedding session is full.");await (0,s.mZ)(a,{partnerIds:(0,s.hq)(t)}),await (0,s.mZ)((0,s.H9)(r.db,"users",t),{activeWeddingId:e});let i=await (0,s.x7)(a);return{id:i.id,...i.data()}},l=async e=>{let t=(0,s.P)((0,s.rJ)(r.db,"weddings"),(0,s._M)("shareCode","==",e)),a=await (0,s.GG)(t);if(!a.empty){let e=a.docs[0];return{id:e.id,...e.data()}}return null},o=async(e,t)=>{await (0,s.mZ)((0,s.H9)(r.db,"weddings",e),t)},c=async(e,t)=>{let a=(0,s.H9)(r.db,"weddings",e);await (0,s.mZ)(a,{partnerIds:(0,s.C3)(t)}),await (0,s.mZ)((0,s.H9)(r.db,"users",t),{activeWeddingId:null})},u=async e=>{await (0,s.kd)((0,s.H9)(r.db,"weddings",e))},m=async e=>({id:(await (0,s.gS)((0,s.rJ)(r.db,"tasks"),{...e,createdAt:(0,s.O5)(),lastUpdatedAt:(0,s.O5)()})).id,...e,createdAt:s.Dc.now(),lastUpdatedAt:s.Dc.now()}),p=async(e,t)=>{await (0,s.mZ)((0,s.H9)(r.db,"tasks",e),{...t,lastUpdatedAt:(0,s.O5)()})},x=async e=>{await (0,s.kd)((0,s.H9)(r.db,"tasks",e))}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,391,352,239,521,178,76,162,837,825,441,684,358],()=>t(4820)),_N_E=e.O()}]);