(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{3873:(e,t,a)=>{"use strict";a.d(t,{W:()=>o,i:()=>c});var s=a(5155),d=a(2115),r=a(283),i=a(5317),n=a(7039);let l=(0,d.createContext)(void 0),o=e=>{let{children:t}=e,{user:a,loading:o}=(0,r.A)(),[c,u]=(0,d.useState)(null),[m,f]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{let e;if(o)return void f(!0);if((null==a?void 0:a.activeWeddingId)&&n.db){f(!0);let t=(0,i.H9)(n.db,"weddings",a.activeWeddingId);e=(0,i.aQ)(t,e=>{e.exists()?u({id:e.id,...e.data()}):(u(null),console.warn("Firestore_WeddingContext: Active wedding session ".concat(a.activeWeddingId," not found."))),f(!1)},e=>{console.error("Firestore_WeddingContext: Error listening to wedding session:",e),u(null),f(!1)})}else u(null),f(!1);return()=>{e&&e()}},[a,o]),(0,s.jsx)(l.Provider,{value:{weddingSession:c,setWeddingSession:u,loadingSession:m},children:t})},c=()=>{let e=(0,d.useContext)(l);if(void 0===e)throw Error("useWedding must be used within a WeddingProvider");return e}},4636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>n,Wv:()=>l,hl:()=>o});var s=a(5155),d=a(2115),r=a(547),i=a(9434);let n=r.bL,l=r.l9,o=d.forwardRef((e,t)=>{let{className:a,align:d="center",sideOffset:n=4,...l}=e;return(0,s.jsx)(r.ZL,{children:(0,s.jsx)(r.UC,{ref:t,align:d,sideOffset:n,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});o.displayName=r.UC.displayName},5511:(e,t,a)=>{"use strict";a.d(t,{V:()=>o});var s=a(5155);a(2115);var d=a(965),r=a(3158),i=a(8049),n=a(9434),l=a(285);function o(e){let{className:t,classNames:a,showOutsideDays:o=!0,...c}=e;return(0,s.jsx)(i.hv,{showOutsideDays:o,className:(0,n.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,n.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,n.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(d.A,{className:(0,n.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,n.cn)("h-4 w-4",t),...a})}},...c})}o.displayName="Calendar"},5890:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var s=a(5155),d=a(221),r=a(2177),i=a(5594),n=a(285),l=a(7759),o=a(5511),c=a(4636),u=a(9434),m=a(3013),f=a(1920),g=a(172),h=a(8666),x=a(283),p=a(7481),w=a(5695),v=a(2115);let b=i.Ik({weddingDate:i.p6({required_error:"Wedding date is required."})});function y(){let{user:e}=(0,x.A)(),{toast:t}=(0,p.dj)();(0,w.useRouter)();let[a,i]=(0,v.useState)(!1),y=(0,r.mN)({resolver:(0,d.u)(b),defaultValues:{weddingDate:new Date}});async function j(a){if(!e)return void t({variant:"destructive",title:"Error",description:"You must be logged in to create a wedding."});i(!0);try{await (0,h.r$)(e.uid,a.weddingDate),t({title:"Success!",description:"Wedding session created for ".concat((0,m.GP)(a.weddingDate,"PPP"),".")})}catch(e){t({variant:"destructive",title:"Failed to create wedding",description:e.message}),i(!1)}}return(0,s.jsx)(l.lV,{...y,children:(0,s.jsxs)("form",{onSubmit:y.handleSubmit(j),className:"space-y-8",children:[(0,s.jsx)(l.zB,{control:y.control,name:"weddingDate",render:e=>{let{field:t}=e;return(0,s.jsxs)(l.eI,{className:"flex flex-col items-center",children:[(0,s.jsx)(l.lR,{className:"text-lg font-medium",children:"Select Your Wedding Date"}),(0,s.jsxs)(c.AM,{children:[(0,s.jsx)(c.Wv,{asChild:!0,children:(0,s.jsx)(l.MJ,{children:(0,s.jsxs)(n.$,{variant:"outline",className:(0,u.cn)("w-[240px] pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,m.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"}),(0,s.jsx)(f.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(c.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(o.V,{mode:"single",selected:t.value,onSelect:t.onChange,disabled:e=>e<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),(0,s.jsx)(l.C5,{})]})}}),(0,s.jsxs)(n.$,{type:"submit",className:"w-full",disabled:a,children:[a&&(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Wedding"]})]})})}var j=a(2523);let N=i.Ik({shareCode:i.Yj().min(6,{message:"Share code must be at least 6 characters."}).max(10,{message:"Share code too long."})});function C(){let{user:e}=(0,x.A)(),{toast:t}=(0,p.dj)();(0,w.useRouter)();let[a,i]=(0,v.useState)(!1),o=(0,r.mN)({resolver:(0,d.u)(N),defaultValues:{shareCode:""}});async function c(a){if(!e)return void t({variant:"destructive",title:"Error",description:"You must be logged in to join a wedding."});i(!0);try{let s=await (0,h.dH)(a.shareCode.toUpperCase());if(!s){t({variant:"destructive",title:"Not Found",description:"Invalid share code. Please check and try again."}),i(!1);return}await (0,h.Pv)(s.id,e.uid),t({title:"Success!",description:"You have joined the wedding session."})}catch(e){t({variant:"destructive",title:"Failed to join wedding",description:e.message}),i(!1)}}return(0,s.jsx)(l.lV,{...o,children:(0,s.jsxs)("form",{onSubmit:o.handleSubmit(c),className:"space-y-8",children:[(0,s.jsx)(l.zB,{control:o.control,name:"shareCode",render:e=>{let{field:t}=e;return(0,s.jsxs)(l.eI,{className:"flex flex-col items-center",children:[(0,s.jsx)(l.lR,{className:"text-lg font-medium",children:"Enter Share Code"}),(0,s.jsx)(l.MJ,{children:(0,s.jsx)(j.p,{placeholder:"ABCXYZ",...t,className:"uppercase text-center tracking-widest text-lg h-12"})}),(0,s.jsx)(l.C5,{})]})}}),(0,s.jsxs)(n.$,{type:"submit",className:"w-full",disabled:a,children:[a&&(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Join Wedding"]})]})})}var _=a(6695),W=a(704);let A=W.bL,I=v.forwardRef((e,t)=>{let{className:a,...d}=e;return(0,s.jsx)(W.B8,{ref:t,className:(0,u.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...d})});I.displayName=W.B8.displayName;let k=v.forwardRef((e,t)=>{let{className:a,...d}=e;return(0,s.jsx)(W.l9,{ref:t,className:(0,u.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...d})});k.displayName=W.l9.displayName;let D=v.forwardRef((e,t)=>{let{className:a,...d}=e;return(0,s.jsx)(W.UC,{ref:t,className:(0,u.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...d})});D.displayName=W.UC.displayName;var P=a(3873);function S(){let{user:e,loading:t}=(0,x.A)(),{weddingSession:a,loadingSession:d}=(0,P.i)(),r=(0,w.useRouter)();return((0,v.useEffect)(()=>{t||e||r.replace("/login"),!d&&a&&r.replace("/dashboard")},[e,t,a,d,r]),t||d||!t&&!e||!d&&a)?(0,s.jsx)("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,s.jsx)(g.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,s.jsx)("div",{className:"container mx-auto flex min-h-[calc(100vh-var(--header-height,4rem))] flex-col items-center justify-center p-4",children:(0,s.jsxs)(_.Zp,{className:"w-full max-w-lg shadow-xl",children:[(0,s.jsxs)(_.aR,{className:"text-center",children:[(0,s.jsx)(_.ZB,{className:"text-3xl font-headline text-primary",children:"Welcome to TogetherPlan!"}),(0,s.jsx)(_.BT,{className:"text-lg",children:"Let's get started with your wedding planning."})]}),(0,s.jsx)(_.Wu,{children:(0,s.jsxs)(A,{defaultValue:"create",className:"w-full",children:[(0,s.jsxs)(I,{className:"grid w-full grid-cols-2",children:[(0,s.jsx)(k,{value:"create",children:"Create Wedding"}),(0,s.jsx)(k,{value:"join",children:"Join Wedding"})]}),(0,s.jsx)(D,{value:"create",className:"pt-6",children:(0,s.jsx)(y,{})}),(0,s.jsx)(D,{value:"join",className:"pt-6",children:(0,s.jsx)(C,{})})]})})]})})}},6140:(e,t,a)=>{Promise.resolve().then(a.bind(a,5890))},8666:(e,t,a)=>{"use strict";a.d(t,{EA:()=>u,Pv:()=>n,UT:()=>m,dH:()=>l,ii:()=>o,lC:()=>f,r$:()=>i,vq:()=>g,yk:()=>c});var s=a(5317),d=a(7039);let r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a="";for(let s=0;s<e;s++)a+=t.charAt(Math.floor(Math.random()*t.length));return a},i=async(e,t)=>{let a=s.Dc.fromDate(t),i=r(),n=await (0,s.gS)((0,s.rJ)(d.db,"weddings"),{ownerId:e,partnerIds:[e],weddingDate:a,shareCode:i,createdAt:(0,s.O5)()});return await (0,s.mZ)((0,s.H9)(d.db,"users",e),{activeWeddingId:n.id}),{id:n.id,ownerId:e,partnerIds:[e],weddingDate:a,shareCode:i,createdAt:s.Dc.now()}},n=async(e,t)=>{let a=(0,s.H9)(d.db,"weddings",e),r=await (0,s.x7)(a);if(!r.exists())throw Error("Wedding session not found.");let i=r.data();if(i.partnerIds.includes(t))return await (0,s.mZ)((0,s.H9)(d.db,"users",t),{activeWeddingId:e}),{id:r.id,...i};if(i.partnerIds.length>=2)throw Error("Wedding session is full.");await (0,s.mZ)(a,{partnerIds:(0,s.hq)(t)}),await (0,s.mZ)((0,s.H9)(d.db,"users",t),{activeWeddingId:e});let n=await (0,s.x7)(a);return{id:n.id,...n.data()}},l=async e=>{let t=(0,s.P)((0,s.rJ)(d.db,"weddings"),(0,s._M)("shareCode","==",e)),a=await (0,s.GG)(t);if(!a.empty){let e=a.docs[0];return{id:e.id,...e.data()}}return null},o=async(e,t)=>{await (0,s.mZ)((0,s.H9)(d.db,"weddings",e),t)},c=async(e,t)=>{let a=(0,s.H9)(d.db,"weddings",e);await (0,s.mZ)(a,{partnerIds:(0,s.C3)(t)}),await (0,s.mZ)((0,s.H9)(d.db,"users",t),{activeWeddingId:null})},u=async e=>{await (0,s.kd)((0,s.H9)(d.db,"weddings",e))},m=async e=>({id:(await (0,s.gS)((0,s.rJ)(d.db,"tasks"),{...e,createdAt:(0,s.O5)(),lastUpdatedAt:(0,s.O5)()})).id,...e,createdAt:s.Dc.now(),lastUpdatedAt:s.Dc.now()}),f=async(e,t)=>{await (0,s.mZ)((0,s.H9)(d.db,"tasks",e),{...t,lastUpdatedAt:(0,s.O5)()})},g=async e=>{await (0,s.kd)((0,s.H9)(d.db,"tasks",e))}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,391,352,239,521,178,76,298,825,441,684,358],()=>t(6140)),_N_E=e.O()}]);